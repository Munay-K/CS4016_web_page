---
import { eventosPorSemana } from "../content/events.js";

// CÃ¡lculo de fechas y progreso
const fechaInicioCurso = new Date("2025-03-24");
const today = new Date();
const diasTranscurridos = Math.floor((today - fechaInicioCurso) / (1000 * 60 * 60 * 24));
const semanaActual = Math.max(1, Math.min(16, Math.ceil(diasTranscurridos / 7)));
---

<table class="table-auto w-full text-left border-collapse mt-4">
  <thead>
    <tr>
      <th class="border px-4 py-2">Semana</th>
      <th class="border px-4 py-2">Fecha</th>
      <th class="border px-4 py-2">Evento</th>
      <th class="border px-4 py-2">Detalles</th>
    </tr>
  </thead>
  <tbody>
    {Array.from({ length: 16 }, (_, i) => {
      const semana = i + 1;
      const eventos = eventosPorSemana[semana] || [];
      const esSemanaActual = semana === semanaActual;
      const claseFila = esSemanaActual ? "bg-yellow-100 font-bold" : "";

      if (eventos.length === 0) {
        return (
          <tr class={claseFila}>
            <td class="border px-4 py-2">{semana}</td>
            <td class="border px-4 py-2">-</td>
            <td class="border px-4 py-2">ðŸ“„ Sin eventos</td>
            <td class="border px-4 py-2">-</td>
          </tr>
        );
      }

      return eventos.map(({ fecha, evento, detalles }) => {
        const fechaEvento = new Date(fecha + "T00:00:00");
        const fechaFormateada = fechaEvento.toLocaleDateString('es-PE', {
          day: 'numeric',
          month: 'numeric',
          year: 'numeric'
        });
        return (
          <tr class={claseFila}>
            <td class="border px-4 py-2">{semana}</td>
            <td class="border px-4 py-2">{fechaFormateada}</td>
            <td class="border px-4 py-2">{evento}</td>
            <td class="border px-4 py-2">{detalles}</td>
          </tr>
        );
      });
    })}
  </tbody>
</table>
